<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="./css/styles.css">
  <link rel="stylesheet" href="./css/querys.css">
  <link rel="stylesheet" href="./css/backend.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
  <script src="./js/script.js"></script>
  <title>Document</title>
</head>

<body id="back">
  <header>
    <h2 class="logo"></h2>
    <nav class="navigation">
      <a href="./index.html">Home<span></span></a>
      <a href="./index.html#about">About<span></span></a>
      <a href="./index.html#service">Service<span></span></a>
      <a href="./index.html#contact">Contact<span></span></a>
      <span id="login-status"></span> <!-- Aquí mostraremos el nombre de usuario o el enlace de inicio de sesión -->
      <button id="logout-button" style="display: none;"><i class="fa-solid fa-right-from-bracket"></i></button> <!-- Botón de cerrar sesión -->
    </nav>

    <script>
      document.addEventListener("DOMContentLoaded", () => {
        const loginStatus = document.getElementById('login-status');
        const logoutButton = document.getElementById('logout-button');

        // Verificar si hay un nombre de usuario almacenado en localStorage
        const username = localStorage.getItem('username');
        if (username) {
          loginStatus.textContent = ` ${username}`; // Mostrar el nombre de usuario
          logoutButton.style.display = 'inline'; // Mostrar el botón de cerrar sesión
        } else {
          loginStatus.innerHTML = '<a href="./login.html">Login<span></span></a>'; // Si no hay usuario logeado, mostrar el enlace de login
        }

        logoutButton.addEventListener('click', () => {
          // Eliminar los datos del usuario del localStorage al hacer clic en "Cerrar sesión"
          localStorage.removeItem('username');
          localStorage.removeItem('token');

          // Redirigir al usuario a la página de inicio de sesión después de cerrar sesión
          window.location.href = './login.html';
        });
      });
    </script>

    <nav role="navigation">
      <div id="menuToggle">
        <input type="checkbox" />
        <span></span>
        <span></span>
        <span></span>
        <ul id="menu">
          <a href="./index.html#">
            <li>Home</li>
          </a>
          <a href="./index.html#service">
            <li>Service</li>
          </a>
          <a href="./index.html#about">
            <li>About</li>
          </a>
          <a href="./index.html#contact">
            <li>Contact</li>
          </a>
        </ul>
      </div>
    </nav>
  </header>
  <section>
    <form id="formulario-ataud">
      <label for="nombre">Nombre:</label>
      <input type="text" id="nombre" name="nombre" required><br>
      
      <label for="categoria">Categoría:</label>
      <input type="text" id="categoria" name="categoria" required><br>
      
      <label for="precio">Precio:</label>
      <input type="number" id="precio" name="precio" required><br>
      
      <label for="material">Material:</label>
      <input type="text" id="material" name="material" required><br>

      <label for="imagen">Imagen:</label>
      <input type="text" id="imagen" name="imagen" required><br>
      <button type="submit" class="insert-button">+</button>
    </form>
    <div class="tbl-header">
      <table cellpadding="0" cellspacing="0" border="0">
        <thead>
          <tr>
            <th>ID</th>
            <th>NOMBRE</th>
            <th>CATEGORIA</th>
            <th>PRECIO (€)</th>
            <th>MATERIAL</th>
            <th>IMAGEN</th>
            <th>Actions</th> <!-- Agregamos la columna de acciones -->
          </tr>
        </thead>
      </table>
    </div>
    <div class="tbl-content">
      <table cellpadding="0" cellspacing="0" border="0">
        <tbody>
          <!-- Los datos se agregarán aquí dinámicamente -->
        </tbody>
      </table>
    </div>
  </section>
  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const loginStatus = document.getElementById('login-status');
      const logoutButton = document.getElementById('logout-button');
    
      // Verificar si hay un nombre de usuario almacenado en localStorage
      const username = localStorage.getItem('username');
      if (username) {
        loginStatus.textContent = ` ${username}`; // Mostrar el nombre de usuario
        logoutButton.style.display = 'inline'; // Mostrar el botón de cerrar sesión
      } else {
        loginStatus.innerHTML = '<a href="./login.html">Login<span></span></a>'; // Si no hay usuario logeado, mostrar el enlace de login
        // Redirigir al usuario a la página de inicio de sesión si no está autenticado
        window.location.href = './login.html';
      }
    
      logoutButton.addEventListener('click', () => {
        // Eliminar los datos del usuario del localStorage al hacer clic en "Cerrar sesión"
        localStorage.removeItem('username');
        localStorage.removeItem('token');
    
        // Redirigir al usuario a la página de inicio de sesión después de cerrar sesión
        window.location.href = './login.html';
      });
    
      // Realizar una solicitud HTTP GET para obtener los datos de la URL
      fetch('https://api-cementerio.vercel.app/ataudes')
        .then(response => response.json()) // Convertir la respuesta a formato JSON
        .then(data => {
          const tableBody = document.querySelector('.tbl-content tbody');

          // Iterar sobre los datos y agregar cada fila a la tabla
          data.forEach(item => {
            const row = document.createElement('tr');
            row.innerHTML = `
              <td>${item.id}</td>
              <td>${item.nombre}</td>
              <td>${item.categoria}</td>
              <td>${item.precio}</td>
              <td>${item.material}</td>
              <td><img src="${item.imagen}" alt="${item.nombre}" width="100"></td>
              <td><button class="delete-button" data-id="${item.id}"><i class="fa-solid fa-trash"></i></button></td> <!-- Agregamos el botón de borrar -->
            `;
            tableBody.appendChild(row);
          });

          // Agregar event listener para los botones de borrar
          document.querySelectorAll('.delete-button').forEach(button => {
            button.addEventListener('click', () => {
              const id = button.getAttribute('data-id');
              const confirmDelete = confirm("¿Estás seguro de que deseas eliminar este ataúd?");
              if (confirmDelete) {
                fetch(`https://api-cementerio.vercel.app/ataudes/${id}`, {
                  method: 'DELETE'
                })
                .then(() => {
                  // Eliminar la fila de la tabla una vez que se ha eliminado el ataúd
                  button.closest('tr').remove();
                })
                .catch(error => {
                  console.error('Error al eliminar el ataúd:', error);
                });
              }
            });
          });
        })
        .catch(error => {
          console.error('Error al cargar los datos:', error);
        });
    });
  </script>
</body>

</html>
